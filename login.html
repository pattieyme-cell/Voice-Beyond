<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - Voice Beyond üíú</title>
    <meta name="description" content="Sign in to Voice Beyond to access your AI companions and continue your healing journey.">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíú</text></svg>">
</head>
<body>
    <!-- Header Navigation -->
    <header>
        <nav class="container">
            <a href="index.html" class="logo">Voice Beyond üíú</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="login.html" class="active">Sign In</a></li>
            </ul>
            <div class="mobile-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <!-- Login Section -->
    <main class="dashboard">
        <div class="container" style="max-width: 500px;">
            <!-- Login Form Container -->
            <div class="form-container fade-in" style="margin-top: 2rem;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h2>Welcome Back</h2>
                    <p style="color: var(--text-secondary);">Sign in to continue your healing journey</p>
                </div>

                <!-- Google Sign In Button -->
                <button id="googleSignIn" class="btn" style="width: 100%; background: #4285f4; color: white; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; gap: 0.75rem; padding: 0.875rem 1rem;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Continue with Google
                </button>

                <!-- Divider -->
                <div style="text-align: center; margin: 1.5rem 0; position: relative;">
                    <div style="height: 1px; background: #e9ecef;"></div>
                    <span style="background: white; padding: 0 1rem; color: var(--text-secondary); position: absolute; top: -0.5rem; left: 50%; transform: translateX(-50%); font-size: 0.875rem;">or</span>
                </div>

                <!-- Traditional Login Form -->
                <form id="loginForm">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" class="form-control" placeholder="Enter your email" required>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password" required>
                        <div style="text-align: right; margin-top: 0.5rem;">
                            <a href="#forgot-password" style="font-size: 0.875rem; color: var(--primary-color); text-decoration: none;">Forgot password?</a>
                        </div>
                    </div>

                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal; cursor: pointer;">
                            <input type="checkbox" id="rememberMe" name="rememberMe" style="accent-color: var(--primary-color);">
                            Remember me
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                        Sign In
                    </button>
                </form>

                <!-- Sign Up Link -->
                <div style="text-align: center; padding-top: 1rem; border-top: 1px solid #e9ecef;">
                    <p style="margin: 0; color: var(--text-secondary);">
                        Don't have an account? 
                        <a href="#signup" style="color: var(--primary-color); text-decoration: none; font-weight: 500;">Create account</a>
                    </p>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="card fade-in" style="margin-top: 2rem; text-align: center;">
                <h3>üîí Your Privacy is Our Priority</h3>
                <p style="margin-bottom: 1rem;">
                    Your conversations and personal information are encrypted and completely confidential. 
                    We never share your data with third parties.
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; font-size: 0.875rem; color: var(--text-secondary);">
                    <span>üõ°Ô∏è End-to-end encryption</span>
                    <span>üîê GDPR compliant</span>
                    <span>üíú Made for healing</span>
                </div>
            </div>

            <!-- Demo Account Info -->
            <div class="card fade-in" style="margin-top: 1.5rem; background: var(--light-gray);">
                <h4>‚ú® Try Voice Beyond</h4>
                <p style="margin-bottom: 1rem; font-size: 0.9rem;">
                    New to Voice Beyond? You can try our platform with a demo account or sign in with Google for the easiest experience.
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button onclick="tryDemo()" class="btn btn-secondary" style="font-size: 0.875rem;">Try Demo</button>
                    <a href="about.html" class="btn btn-secondary" style="font-size: 0.875rem; text-decoration: none;">Learn More</a>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer style="margin-top: 4rem;">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Voice Beyond üíú</h4>
                    <p>Where memories find a voice again. A compassionate platform for emotional healing through AI companionship.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="login.html">Sign In</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul class="footer-links">
                        <li><a href="#privacy">Privacy Policy</a></li>
                        <li><a href="#terms">Terms of Service</a></li>
                        <li><a href="#contact">Contact Support</a></li>
                        <li><a href="#help">Help Center</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul class="footer-links">
                        <li><a href="#crisis">Crisis Support</a></li>
                        <li><a href="#therapy">Find a Therapist</a></li>
                        <li><a href="#community">Community</a></li>
                        <li><a href="#blog">Blog & Stories</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Voice Beyond. Made with heart üíú by Pattiee & Team. All rights reserved.</p>
                <p style="margin-top: 0.5rem; font-size: 0.8rem; opacity: 0.8;">
                    If you're experiencing a crisis, please contact: 988 (Suicide & Crisis Lifeline) or your local emergency services.
                </p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="script.js"></script>
    
    <!-- Login-specific functionality -->
    <script>
        // Google Sign In handler
        document.getElementById('googleSignIn').addEventListener('click', function() {
            this.innerHTML = `
                <div class="loading"></div>
                Signing in with Google...
            `;
            this.disabled = true;
            
            // Call the existing Google login function
            handleGoogleLogin();
        });

        // Traditional login form handler
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = '<div class="loading" style="width: 16px; height: 16px; margin-right: 0.5rem;"></div>Signing in...';
            submitBtn.disabled = true;
            
            try {
                // Try backend login first
                const data = await handleBackendLogin(email, password);
                
                if (rememberMe) {
                    localStorage.setItem('voiceBeyondRememberMe', 'true');
                }
                
                showSuccessMessage(`Welcome back, ${data.user.username}! üíú`);
                
                // Redirect to dashboard
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1500);
                
            } catch (error) {
                // Fallback to mock login if backend fails
                console.log('Backend login failed, trying mock login');
                
                const mockUser = {
                    id: 'user_' + Date.now(),
                    name: email.split('@')[0].charAt(0).toUpperCase() + email.split('@')[0].slice(1),
                    email: email,
                    picture: `https://ui-avatars.com/api/?name=${email.split('@')[0]}&background=b57edc&color=fff`,
                    loginTime: new Date().toISOString(),
                    loginMethod: 'email'
                };
                
                // Store user data
                localStorage.setItem('voiceBeyondUser', JSON.stringify(mockUser));
                if (rememberMe) {
                    localStorage.setItem('voiceBeyondRememberMe', 'true');
                }
                
                showSuccessMessage(`Welcome back, ${mockUser.name}! üíú (Offline mode)`);
                
                // Redirect to dashboard
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1500);
            }
        });

        // Demo account function
        function tryDemo() {
            showLoading();
            
            setTimeout(() => {
                const demoUser = {
                    id: 'demo_user',
                    name: 'Demo User',
                    email: 'demo@voicebeyond.com',
                    picture: 'https://ui-avatars.com/api/?name=Demo&background=b57edc&color=fff',
                    loginTime: new Date().toISOString(),
                    loginMethod: 'demo'
                };
                
                // Store demo user data
                localStorage.setItem('voiceBeyondUser', JSON.stringify(demoUser));
                
                // Create a demo character
                const demoCharacter = {
                    id: 'demo_char_1',
                    name: 'Maya',
                    relationship: 'Best Friend',
                    personality: 'Warm and Supportive',
                    topics: 'Always there to listen and provide comfort during difficult times',
                    createdAt: new Date().toISOString(),
                    userId: 'demo_user'
                };
                
                localStorage.setItem('voiceBeyondCharacters', JSON.stringify([demoCharacter]));
                
                hideLoading();
                showSuccessMessage('Welcome to Voice Beyond Demo! üåü');
                
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1500);
                
            }, 1500);
        }

        // Forgot password handler
        document.addEventListener('click', function(e) {
            if (e.target.getAttribute('href') === '#forgot-password') {
                e.preventDefault();
                showMessage('Password recovery will be available soon. For now, please try the Google sign-in or demo account.', 'info');
            }
            
            if (e.target.getAttribute('href') === '#signup') {
                e.preventDefault();
                // Simple registration prompt
                const username = prompt('Enter username:');
                if (!username) return;
                
                const email = prompt('Enter email:');
                if (!email) return;
                
                const password = prompt('Enter password:');
                if (!password) return;
                
                showLoading();
                
                handleBackendRegister(username, email, password)
                    .then(data => {
                        hideLoading();
                        showSuccessMessage(`Welcome ${username}! üíú`);
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1500);
                    })
                    .catch(error => {
                        hideLoading();
                        showMessage(error.message || 'Registration failed. Please try again.', 'error');
                    });
            }
        });

        // Auto-focus email field
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('email').focus();
            
            // Check if user is already logged in
            const currentUser = localStorage.getItem('voiceBeyondUser');
            if (currentUser) {
                const user = JSON.parse(currentUser);
                showMessage(`You're already signed in as ${user.name}. Redirecting to dashboard...`, 'info');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
            }
        });

        // Add subtle animations
        document.querySelectorAll('.form-control').forEach(input => {
            input.addEventListener('focus', function() {
                this.parentNode.style.transform = 'translateY(-2px)';
                this.parentNode.style.transition = 'transform 0.2s ease';
            });
            
            input.addEventListener('blur', function() {
                this.parentNode.style.transform = 'translateY(0)';
            });
        });
    </script>
</body>
</html>